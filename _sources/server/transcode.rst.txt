转码
===================

.. uml::

  start
  :无限循环获取过期的展示;
  if (内容标签匹配)
    :取消过期标记;
    stop
  endif
  :转码;
  :更新内容标签;
  :取消过期标记;
  stop


系统于后台持续将为过期的 :doc:`models/presentation` 转码文件。

对应尺寸的成功 :ref:`内容标签` 不等于原始文件 :ref:`内容标签` 视为过期，
错误 :ref:`内容标签` 和原始文件 :ref:`内容标签` 相同时除外。

根据展示类型进行不同的转码。

同时进行的转码数量由权重限制，见 :doc:`env-vars`。

图片
---------------------

如果原始文件含有多帧，将使用中间帧。

+----------+------+--------------------------------------------------+
|   尺寸   | 格式 |                       描述                       |
+==========+======+==================================================+
| 缩略尺寸 | jpg  | 高度超过 200 像素时保持比例缩小，否则保持不变。  |
+----------+------+--------------------------------------------------+
| 常规尺寸 | jpg  | 高度超过 2160 像素时保持比例缩小，否则保持不变。 |
+----------+------+--------------------------------------------------+

视频
---------------------

+----------+------+--------------------------------------------------+
|   尺寸   | 格式 |                       描述                       |
+==========+======+==================================================+
| 缩略尺寸 | jpg  | 按缩略尺寸图片进行转码。                         |
+----------+------+--------------------------------------------------+
| 常规尺寸 | mp4  | H.264 编码，输出结果只保留不超过 256 MB 的部分。 |
|          |      | 高度超过 1080 像素时保持比例缩小，否则保持不变。 |
+----------+------+--------------------------------------------------+
